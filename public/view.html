<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View File - NexDrop</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --primary: #e53935; --dark: #0a0a0a; --light: #ffffff; --gray: #1a1a1a; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: var(--light); padding: 40px 20px; }
    
    .container { max-width: 1000px; margin: 0 auto; }
    
    h1 { color: var(--primary); margin-bottom: 30px; }
    
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--primary); }
    .tab { padding: 12px 20px; background: transparent; border: none; color: var(--light); cursor: pointer; font-weight: bold; transition: all 0.3s; }
    .tab.active { color: var(--primary); border-bottom: 3px solid var(--primary); }
    
    .content { background: var(--gray); padding: 30px; border-radius: 8px; border: 2px solid var(--primary); }
    
    .preview-image { max-width: 100%; border-radius: 8px; margin: 20px 0; }
    
    .json-output { background: var(--dark); padding: 20px; border-radius: 6px; border: 1px solid #333; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“Š File Information</h1>
    
    <div class="tabs">
      <button class="tab active" onclick="showTab('preview')">Preview</button>
      <button class="tab" onclick="showTab('json')">JSON Data</button>
    </div>
    
    <div class="content">
      <div id="preview-tab">
        <div id="preview-content"></div>
      </div>
      <div id="json-tab" style="display:none;">
        <div class="json-output" id="json-content"></div>
      </div>
    </div>
  </div>

  <script>
    const slug = window.location.pathname.split('/').pop();
    
    async function loadFile() {
      try {
        const response = await fetch(`/api/file/${slug}`);
        const file = await response.json();
        
        // Preview Tab
        const previewContent = document.getElementById('preview-content');
        let previewHTML = `
          <h2>${file.originalName}</h2>
          <p style="color: #888; margin-top: 10px;">
            Size: ${(file.size / (1024 * 1024)).toFixed(2)} MB | 
            Downloads: ${file.downloadCount} | 
            Uploaded by: ${file.uploaderName}
          </p>
        `;
        
        if (file.mimeType.includes('image')) {
          previewHTML += `<img src="/api/download/${slug}" alt="Preview" class="preview-image">`;
        } else if (file.mimeType.includes('video')) {
          previewHTML += `<video controls style="max-width: 100%; border-radius: 8px;">
            <source src="/api/download/${slug}" type="${file.mimeType}">
            Your browser does not support the video tag.
          </video>`;
        } else if (file.mimeType.includes('audio')) {
          previewHTML += `<audio controls style="width: 100%; margin: 20px 0;">
            <source src="/api/download/${slug}" type="${file.mimeType}">
            Your browser does not support the audio tag.
          </audio>`;
        } else {
          previewHTML += `<p style="color: #888;">Preview not available for this file type</p>`;
        }
        
        previewContent.innerHTML = previewHTML;
        
        // JSON Tab
        document.getElementById('json-content').textContent = JSON.stringify(file, null, 2);
      } catch (err) {
        console.error('Error loading file:', err);
      }
    }

    function showTab(tab) {
      document.getElementById('preview-tab').style.display = tab === 'preview' ? 'block' : 'none';
      document.getElementById('json-tab').style.display = tab === 'json' ? 'block' : 'none';
      
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
    }

    loadFile();
  </script>
</body>
</html>
